
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>python 多线程入门 | Hear7v&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Hear7v">
    

    
    <meta name="description" content="前言基本语法，循环，函数，递归，几年来一直没有刷新的技能库，多了解的无非是一些第三方库带来的一些便利。以上所列的如今来看无非是给我的代码的编写，带来不少帮助，但是随着任务的需求，我们不得不把注意力由算法的设计转到计算机资源的更多利用上来。
同样复杂度的算法，所利用的计算机资源的不同对处理问题的效率产生的影响也是很大的。几年来编程的基础技能没有刷新，但是多线程编程的学习，我觉得这是一次对基本技能的重">
<meta property="og:type" content="article">
<meta property="og:title" content="python 多线程入门">
<meta property="og:url" content="http://yoursite.com/2016/01/17/python-多线程入门/index.html">
<meta property="og:site_name" content="Hear7v's Blog">
<meta property="og:description" content="前言基本语法，循环，函数，递归，几年来一直没有刷新的技能库，多了解的无非是一些第三方库带来的一些便利。以上所列的如今来看无非是给我的代码的编写，带来不少帮助，但是随着任务的需求，我们不得不把注意力由算法的设计转到计算机资源的更多利用上来。
同样复杂度的算法，所利用的计算机资源的不同对处理问题的效率产生的影响也是很大的。几年来编程的基础技能没有刷新，但是多线程编程的学习，我觉得这是一次对基本技能的重">
<meta property="og:updated_time" content="2016-02-21T11:28:56.058Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python 多线程入门">
<meta name="twitter:description" content="前言基本语法，循环，函数，递归，几年来一直没有刷新的技能库，多了解的无非是一些第三方库带来的一些便利。以上所列的如今来看无非是给我的代码的编写，带来不少帮助，但是随着任务的需求，我们不得不把注意力由算法的设计转到计算机资源的更多利用上来。
同样复杂度的算法，所利用的计算机资源的不同对处理问题的效率产生的影响也是很大的。几年来编程的基础技能没有刷新，但是多线程编程的学习，我觉得这是一次对基本技能的重">

    
    <link rel="alternative" href="/atom.xml" title="Hear7v&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Hear7v&#39;s Blog" title="Hear7v&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Hear7v&#39;s Blog">Hear7v&#39;s Blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/category">Category</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/17/python-多线程入门/" title="python 多线程入门" itemprop="url">python 多线程入门</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Hear7v" target="_blank" itemprop="author">Hear7v</a>
		
  <p class="article-time">
    <time datetime="2016-01-17T12:26:21.000Z" itemprop="datePublished"> 發表於 2016-01-17</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-number">2.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#进程"><span class="toc-number">2.1.</span> <span class="toc-text">进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程"><span class="toc-number">2.2.</span> <span class="toc-text">线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局解释器"><span class="toc-number">2.3.</span> <span class="toc-text">全局解释器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#退出线程"><span class="toc-number">2.4.</span> <span class="toc-text">退出线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python_模块"><span class="toc-number">3.</span> <span class="toc-text">Python 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#thread模块"><span class="toc-number">3.1.</span> <span class="toc-text">thread模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#threading模块"><span class="toc-number">3.2.</span> <span class="toc-text">threading模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#守护线程"><span class="toc-number">3.2.1.</span> <span class="toc-text">守护线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Thread类"><span class="toc-number">3.2.2.</span> <span class="toc-text">Thread类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#threading模块中的其他函数"><span class="toc-number">3.2.3.</span> <span class="toc-text">threading模块中的其他函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#生产者消费者问题和Queue模块"><span class="toc-number">3.2.4.</span> <span class="toc-text">生产者消费者问题和Queue模块</span></a></li></ol></li></ol></li></ol>
		
		</div>
		
		<h2 id="前言">前言</h2><p>基本语法，循环，函数，递归，几年来一直没有刷新的技能库，多了解的无非是一些第三方库带来的一些便利。以上所列的如今来看无非是给我的代码的编写，带来不少帮助，但是随着任务的需求，我们不得不把注意力由算法的设计转到计算机资源的更多利用上来。</p>
<p>同样复杂度的算法，所利用的计算机资源的不同对处理问题的效率产生的影响也是很大的。几年来编程的基础技能没有刷新，但是多线程编程的学习，我觉得这是一次对基本技能的重大扩充。</p>
<p>由于之前对多线程的接触仅仅是概念和工具上的体验，网上的教程所涉及的深度参差不齐，所以这里就先就着《python 核心编程》多线程编程这章学习。至于其他一些高级模块的加入和内容的扩展，之后随着学习的深入再加扩充。</p>
<h2 id="基本概念">基本概念</h2><h3 id="进程">进程</h3><p>进程是程序的一次执行。每个进程都有自己的地址空间、内存、数据栈及其他记录其运行轨迹的辅助数据。操作系统管理在其上运行的所用进程，为这些进程公平地分配时间、进程也可以通过fork和spawn操作来完成其他的任务。不过个个进程有自己的内存空间、数据栈等，所以只能使用进程间通讯(IPC)而不能直接共享信息。</p>
<h3 id="线程">线程</h3><p>跟进程有些相似，不同的是，所有的线程运行在同一个进程中，共享相同的运行环境。他们可以被想象成实在主进程或“主线程”中并行运行的“迷你进程”。</p>
<p>线程有开始、顺序执行和结束三部分。它有一个自己的指令指针，记录自己运行到什么地方，一个进程的线程共享一块数据空间。</p>
<h3 id="全局解释器">全局解释器</h3><p>Python在设计之初就考虑到在主循环中，同时只有一个线程在运行，虽然Python解释器中可以“运行”多个线程，但在任意时刻，只有一个线程在解释器中运行。</p>
<p>对python虚拟机的访问由全局解释器锁(<code>GIL</code>)来控制，正是这个锁保证同一时刻只有一个线程在运行。在多线程环境中，Python虚拟机按以下方式执行。</p>
<ul>
<li>设置GIL</li>
<li>切换到一个线程去运行</li>
<li>运行<ul>
<li>指定数量的字节码的指令，</li>
<li>线程主动让出控制（可以调用<code>time.sleep(0)</code>）</li>
</ul>
</li>
<li>把线程设为睡眠状态</li>
<li>解锁GIL</li>
<li>再次重复以上所有步骤</li>
</ul>
<p>在调用外部代码的时候，GIL将会被锁定，直到这个函数结束为止（由于在这期间没有Python字节码被运行，所以不会线程切换）。编写扩展的程序员可以主动解锁GIL。</p>
<h3 id="退出线程">退出线程</h3><p>当一个线程结束运算，他就退出了。线程可以调用<code>thread.exit()</code>之类的退出函数，也可以使用Python退出进程的标准方法，如<code>sys.exit()</code>或抛出一个<code>SystemExit</code>异常等。</p>
<h2 id="Python_模块">Python 模块</h2><p>Python提供了几个用于多线程编程的模块，包括<code>thread</code>、<code>threading</code>和<code>Queue</code>等。<code>thread</code>和<code>threading</code>模块允许程序员创建和管理线程。<code>thread</code>模块提供了基本的线程和锁的支持，而<code>threading</code>提供了更高级别，功能更强的线程管理的功能。<code>Queue</code>模块允许用户创建一个可以用于多个线程之间共享数据的队列数据结构。</p>
<p>访问线层的底层结构的时候建议使用<code>thread</code>，保证代码的可读性和更快地将多线程运用到应用中建议使用<code>threading</code>。</p>
<h3 id="thread模块">thread模块</h3><p>常用的线程函数以及LockType类型的锁对象方法。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>模块函数</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>start_new_thread(function,args kwargs=None)</td>
<td style="text-align:left">产生一个新的线程，指定的参数和可选的kwargs来调用这个函数</td>
</tr>
<tr>
<td>allocate_lock</td>
<td style="text-align:left">分配一个LockType类型的锁对象</td>
</tr>
<tr>
<td>exit()</td>
<td style="text-align:left">让线程退出</td>
</tr>
<tr>
<td>LockType类型锁对象方法</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>acquire(waite=None)</td>
<td style="text-align:left">尝试获取锁对象</td>
</tr>
<tr>
<td>locked()</td>
<td style="text-align:left">如果获取了锁对象返回True，否则返回False</td>
</tr>
<tr>
<td>release()</td>
<td style="text-align:left">释放锁</td>
</tr>
</tbody>
</table>
<p><strong>start_new_threading()</strong><br>是thread模块的一个关键函数，他的语法与内建的apply()函数完全一样，其参数为：函数，函数的参数以及可选的关键字参数。不同的是，函数不是在主线程里运行。而是产生一个新的线程来运行这个函数。<br>Exa：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> thread</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep,ctime</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop0</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'start loop 0 at:'</span>,ctime()</span><br><span class="line">	sleep(<span class="number">4</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'loop 0 done at:'</span>,ctime()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop1</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'start loop 1 at:'</span>,ctime()</span><br><span class="line">	sleep(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'loop 0 done at:'</span>,ctime()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'starting at:'</span>,ctime()</span><br><span class="line">	thread.start_new_threading(loop0,())</span><br><span class="line">	thread.start_new_threading(loop1,())</span><br><span class="line">	sleep(<span class="number">6</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'all DONE at: '</span>,ctime()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure></p>
<p>这样loop0，loop1并发执行，4s内两处都执行完，我们主函数多加一处sleep(6)是为了保证两处执行完再输出’all DONE’，如果我们没让主线程停下来，那主线程就会立即执行下一句，输出。</p>
<p>那么我们有没有更好的管理线程的方法而不是在主线程里做一个额外的延时6秒的操作。这里我们引入锁的使用。</p>
<p><strong>锁</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> thread</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep,ctime</span><br><span class="line"></span><br><span class="line">loops = [<span class="number">4</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span><span class="params">(nloop, nsec, lock)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'start loop'</span>,loop,<span class="string">'at:'</span>, ctime()</span><br><span class="line">	sleep(nsec)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'loop'</span>,loop,<span class="string">'done at:'</span>, ctime()</span><br><span class="line">	lock.release()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	Print <span class="string">'starting at:'</span>,ctime()</span><br><span class="line">	locks = []</span><br><span class="line">	nloops = range(len(loops))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">		lock = thread.allocate_lock()</span><br><span class="line">		lock.acquire()</span><br><span class="line">		locks.append(lock)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">		thread.start_new_thread(loop,(i,loop[i],locks[i]))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">		<span class="keyword">while</span> lock[i].locked():<span class="keyword">pass</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'all DONE at:'</span>,ctime()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span></span><br><span class="line">	main()</span><br></pre></td></tr></table></figure></p>
<p>代码注释：</p>
<ul>
<li>1-6行：<br>在Unix信息行后面，我们导入了<code>thread</code>模块和<code>time</code>模块里我们早已熟悉的几个函数。我们不再在函数里面写死要等2秒和4秒，而是使用一个<code>loop()</code>函数，把这些常量放在一个列表<code>loops</code>里</li>
<li>8-12行：<br><code>loop()</code>函数替换了我们之前的那几个<code>loop*()</code>函数。在<code>loop()</code>函数里，增加了一些锁的操作。一个很明显的改变是，我们现在要在函数中记录下循环的号码和要睡眠的时间。最后一个不一样的地方就是那个锁了。每个线程都会被分配一个事先已经获得的锁，在<code>sleep()</code>的时间到了之后就释放相应的锁以通知主线程，这个线程已经结束了。</li>
<li><p>14-34行：<br>主要的工作在包含三个循环的<code>main</code>函数中完成。我们先调用<code>thread.allocate_lock()</code>函数创建一个锁的列表。并分别调用各个锁的<code>acquire</code>函数获得锁。获得锁表示“把锁锁上”。</p>
<p>锁上后，我们就把锁放到锁列表<code>locks</code>中。下一个循环创建线程，每个线程都用各自的循环号，睡眠时间和锁为参数去调用<code>loop()</code>函数。</p>
<p>为什么我们不在创建锁的循环里创建线程：</p>
<ul>
<li>我们想到实现线程的同步，所以要让“所有的马同时冲出栅栏”</li>
<li>获取锁要花一些时间，如果你的线程退出得太快，可能会导致还没有获得锁，线程就已经结束了的情况。</li>
</ul>
<p>最后一个循环在那里等待，起到暂停主线程的目的。</p>
</li>
</ul>
<h3 id="threading模块">threading模块</h3><p>threading模块，不仅提供了Thread类，还提供了各种非常好用的同步机制。</p>
<table>
<thead>
<tr>
<th>threading模块对象</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Thread</td>
<td style="text-align:left">表示一个线程的执行对象</td>
</tr>
<tr>
<td>Lock</td>
<td style="text-align:left">锁原语对象(跟thread模块里的锁对象相同)</td>
</tr>
<tr>
<td>Rlock</td>
<td style="text-align:left">可重载入对象，使单线程可以再次获得已经获得了的锁(递归锁定)</td>
</tr>
<tr>
<td>Condition</td>
<td style="text-align:left">条件变量对象能让一个线程停下来，等待其他进程满足了某个“条件”，如，状态的改变或值得改变</td>
</tr>
<tr>
<td>Event</td>
<td style="text-align:left">通用的条件变量。多个线程可以等待某个事件的发生，在事件发生后，所有的线程都会被激活</td>
</tr>
<tr>
<td>Semapgore</td>
<td style="text-align:left">为等待锁的线程提供一个类似“等候室“的结构</td>
</tr>
<tr>
<td>BoundedSemaphore</td>
<td style="text-align:left">与Semaphore类似，只是它不允许超过初始值</td>
</tr>
<tr>
<td>Timer</td>
<td style="text-align:left">与Thread类似，知识它要等待一段时间后才开始运行</td>
</tr>
</tbody>
</table>
<h4 id="守护线程">守护线程</h4><p><strong>又一个避免使用thread模块的原因</strong></p>
<p>thread模块不支持守护线程。当主线程退出时，所有的子进程不论是否还在工作都会强行退出。有时我们并不希望这样的事情发生，于是就引入守护线程的概念。</p>
<p>Threading模块支持守护线程，它们是这样工作的：守护线程是一个等待客户请求服务器，如果没有客户提出请求，他就waiting。如果你设定一个线程为守护线程，就表示你在说这个线程是不重要的，在进程退出的时候，不用等待这个线程退出。</p>
<p>如果你的主线程要退出的时候，不用等待那些子线程完成，那就设定这些线程的daemon属性。即在线程开始之前(调用thread.start())之前，调用setDaemon()函数设定线程的daemon标志(thread.setDaemon(True))就表示这个线程“不重要”。</p>
<p>如果你想等待子线程完成再退出，那就什么都不用做。或者显示地调用thread.setDaemon(False)以保重其daemon标志为False。你可以调用threadisDaemon()函数来判断其daemon标志的值。</p>
<h4 id="Thread类">Thread类</h4><p>用Thread类，你可以用多种方法来创建线程。我们在这里介绍三种比较相像方法。你可以任选一种你喜欢的，或最适合你的程序以及最能满足程序可扩展性的:</p>
<ul>
<li>创建一个Thread的实例，传给它一个函数</li>
<li>创建一个Thread的实例，传给它一个可调用的类对象</li>
<li>从Thread派生出一个子类，创建一个这个子类的实例</li>
</ul>
<table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>start()</td>
<td style="text-align:left">开始线程执行</td>
</tr>
<tr>
<td>run()</td>
<td style="text-align:left">定义线程的功能的函数(一般会被子类重写)</td>
</tr>
<tr>
<td>join(timeout=None)</td>
<td style="text-align:left">程序挂起，直到线程结束；如果给了timeout，则最多阻塞timeout秒</td>
</tr>
<tr>
<td>getName(name)</td>
<td style="text-align:left">设置线程的名字</td>
</tr>
<tr>
<td>isAlive()</td>
<td style="text-align:left">布尔标志，表示这个线程是否还在运行中</td>
</tr>
<tr>
<td>isDaemon()</td>
<td style="text-align:left">返回线程的daemon标志</td>
</tr>
<tr>
<td>setDaemon(daemonic)</td>
<td style="text-align:left">把线程daemon标志设为deamonic(一定要在调用start()函数前调用)</td>
</tr>
</tbody>
</table>
<p><strong>传函数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep, ctime</span><br><span class="line">loops = [<span class="number">4</span>,<span class="number">2</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span><span class="params">(nloop, nsec)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'start loop'</span>, nloop, <span class="string">'at:'</span>, ctime()</span><br><span class="line">	sleep(nsec)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'loop'</span>, nloop,<span class="string">'done at:'</span>, ctime()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'starting at:'</span>, ctime()</span><br><span class="line">	threads = []</span><br><span class="line">	nloops = range(len(loops))</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">		t=threading.Thread(target=loop,args=(i, loops[i]))</span><br><span class="line">		threads.append(t)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops: <span class="comment">#start threads</span></span><br><span class="line">		threads[i].start()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops: <span class="comment">#wait for all</span></span><br><span class="line">		threads[i].join()<span class="comment">#threads to finish</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'all DONE at:'</span>, ctime()</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>与之前所使用的方法相比，thread模块时使用的锁没了，新加了一些Thread对象。在实例化每个Thread对象的时候，我们把函数(target)和参数(args)传进去，得到返回的Thread实例。实例化一个Thread与调用thread.start_new_thread()之间最大的区别就是，新的线程不会立即开始，在你创建线程对象，但不想马上开始运行线程的时候，这是一个很有用的同步特性。</p>
<p>所用线程都创建了之后，再一起调用start()函数启动，而不是创建一个启动一个。而且，不用再管理一堆锁(分配锁，获得锁，释放锁，检查锁的状态等)，只要简单地对每个线程调用join()函数就可以了。</p>
<p>join()会等到线程结束，或者在给了timeout参数的时候，超时为止，使用join看上去会比使用一个等待释放的无限循环清楚一些（这种锁也被称为’自旋锁’）</p>
<p>join()的另一个比较重要的方面是它可以完全不用调用。一旦线程启动后，就会一直运行，直到线层的函数结束，退出为止。如果你的主线程除了等待线程结束外，还有其他的事情要做（处理等待用户请求），那就不用调用join()，只有在你要等待线程结束的时候采用调用join().</p>
<p><strong>传可调用的对象</strong></p>
<p>与传一个函数很相似的方法就是方法就是在创建线程的时候，传一个可调用的类的实例供线程启动的时候执行————这是多线程编程一个更为面向对象的方法。相对于一个或几个函数来说，由于类对象里可以使用类的强大功能，可以保存更多的信息，这种方法更加灵活。</p>
<p>这次的代码，主要增加了<code>ThreadFunc</code>类和创建<code>Thread</code>对象时会实例化一个可调用类ThreadFunc的类对象。下面我们来仔细看看<code>ThreadFunc</code>类吧。</p>
<p>我们想让这个类在调用什么函数方面尽可能地通用，并不局限于那个<code>loop()</code>函数。所以我们加了一些修改，这个类保存了函数的参数，函数本身以及函数的名字字符串。构造器<code>__init__()</code>里做了这些值的赋值工作。</p>
<p>创建新线程的时候，Thread对象会调用我们的ThreadFunc对象，这是会用到一个特殊函数<code>__call__()</code>。由于我们已经有了要用的参数，所以就不用再传到<code>Thread</code>的构造器中。由于我们有一个参数的元组。这时要在代码中使用<code>apply()</code>函数。再高版本的python中可能会有些新的调用方法比如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.res = self.func(*self.args)</span><br></pre></td></tr></table></figure></p>
<p>此例中，我们传了一个可调用的类（的实例），而不是一个函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env/ python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">form time <span class="keyword">import</span> sleep, ctime</span><br><span class="line">loops = [<span class="number">4</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadFunc</span><span class="params">(object)</span>:</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func, args, name=<span class="string">''</span>)</span>:</span></span><br><span class="line">		self.name = name</span><br><span class="line">		self.func = func</span><br><span class="line">		self.args = args</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">		apply(self.func, self.args)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span><span class="params">(nloop, nsec)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'start loop'</span>, nloop, <span class="string">'at:'</span>, ctime()</span><br><span class="line">	sleep(nsec)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'loop'</span>, nloop, <span class="string">'done at:'</span>, ctime()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'starting at:'</span>, ctime()</span><br><span class="line">	threads = []</span><br><span class="line">	nloops = range(len(loops))</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops: <span class="comment"># create all threads</span></span><br><span class="line">		t = threading.Thread(</span><br><span class="line">			target = ThreadFunc(loop, (i, loops[i]), </span><br><span class="line">			loop.__name__))</span><br><span class="line">		threads.append(t)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops: <span class="comment"># start all threads</span></span><br><span class="line">		threads[i].start()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops: <span class="comment"># wait for completion</span></span><br><span class="line">		threads[i].join()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'all DONE at:'</span>, ctime()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p><strong>子类化使用</strong><br>从<code>Thread</code>派生出一个子类，创建一个这个子类的实例。<br>最后一个例子介绍如何子类化Thread类，这与上一个例子中的创建一个可调用的类非常像。使用子类化创建线程(第29~30行)使代码看上去更清晰明了。</p>
<p>我们主要要注意两点：</p>
<ol>
<li>我们的<code>MyThread</code>子类的构造器一定要先调用基类的构造器（第9行）；</li>
<li>之前的特殊函数构造器<code>__call__()</code>在子类中，名字要改为run</li>
</ol>
<p>现在，在<code>MyThread</code>类中，加入一些用于调试的输出信息，把代码保存到<code>myThread</code>模块中，并在下面的例子中导入这个类。除了简单地使用<code>apply()</code>函数来运行这些函数外，我们还把结果保存到实现的<code>self.res</code>属性中，并创建一个新的函数<code>getResult()</code>来得到结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep, ctime</span><br><span class="line"></span><br><span class="line">loops = (<span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func, args, name=<span class="string">''</span>)</span>:</span></span><br><span class="line">		threading.Thread.__init__(self)</span><br><span class="line">		self.name = name</span><br><span class="line">		self.func = func</span><br><span class="line">		self.args = args</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">		apply(self.func, self.args)</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span><span class="params">(nloop, nsec)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'start loop'</span>, nloop, <span class="string">'at:'</span>, ctime()</span><br><span class="line">	sleep(nsec)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'loop'</span>, nloop, <span class="string">'done at:'</span>, ctime()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'starting at:'</span>, ctime()</span><br><span class="line">	threads = []</span><br><span class="line">	nloops = range(len(loops))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">		t = MyThread(loop, (i, loop[i]), loop.__name__)</span><br><span class="line">		threads.append(t)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">		threads[i].start()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">		threads[i].join()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'all DONE at:'</span>, ctime()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p><strong>MyThread 子类化 Thread(myThread.py)</strong></p>
<p>该子类化MyThread更为通用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func, args, name=<span class="string">''</span>)</span>:</span></span><br><span class="line">		threading.Thread.__init__(self)</span><br><span class="line">		self.name = name</span><br><span class="line">		self.func = func</span><br><span class="line">		self.args = args</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">getResult</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> self.res</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">print</span> <span class="string">'starting'</span>, self.name, <span class="string">'at:'</span>,\</span><br><span class="line">			ctime()</span><br><span class="line">		self.res = apply(self.func, self.args)</span><br><span class="line">		<span class="keyword">print</span> self.name, <span class="string">'finished at:'</span>,\</span><br><span class="line">			ctime()</span><br></pre></td></tr></table></figure>
<h4 id="threading模块中的其他函数">threading模块中的其他函数</h4><p>除了各种同步对象和线程对象外，threading模块还提供了一些函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>activeCount()</td>
<td style="text-align:left">当前活动的线程对象的数量</td>
</tr>
<tr>
<td>currentThread()</td>
<td style="text-align:left">返回当前线程对象</td>
</tr>
<tr>
<td>enumerate()</td>
<td style="text-align:left">返回当前活动线程的列表</td>
</tr>
<tr>
<td>settrace(func)</td>
<td style="text-align:left">为所用线程设置一个跟踪函数</td>
</tr>
<tr>
<td>setprofile(func)</td>
<td style="text-align:left">为所有线程设置一个profile函数</td>
</tr>
</tbody>
</table>
<h4 id="生产者消费者问题和Queue模块">生产者消费者问题和Queue模块</h4><p>这一个例子展示了生产者和消费者的关系。生产者生产货物，然后把货物放到一个队列之类的数据结构中，生产货物所要花费的时间无法预先确定。消费者消耗生产者的货物的时间也是不确定的。</p>
<p>Queue模块可以用来进行线程通讯，让各个线程之间共享数据。现在，我们创建一个队列，让生产者（线程）把新生产的货物放进去供消费者（线程）使用。要达到这个目的，我们要使用Queue模块一下属性。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Queue 模块函数</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>queue(size)</td>
<td style="text-align:left">创建一个大小为size的Queue对象</td>
</tr>
<tr>
<td>Queue 对象函数</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>qsize()</td>
<td style="text-align:left">返回队列的大小</td>
</tr>
<tr>
<td>empty()</td>
<td style="text-align:left">如果队列为空返回True，否则返回False</td>
</tr>
<tr>
<td>full()</td>
<td style="text-align:left">如果队列为满返回True，否则返回False</td>
</tr>
<tr>
<td>put(item,block=0)</td>
<td style="text-align:left">把item放到队列中，如果给了block(不为0)，函数会一直阻塞到队列中有空间为止</td>
</tr>
<tr>
<td>get(block=0)</td>
<td style="text-align:left">从队列中取一个对数，如果给了block(不为0),函数会一直阻塞到队列中有对象为止</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> Queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> myThread <span class="keyword">import</span> MyThread</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeQ</span><span class="params">(queue)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">'producing object for Q...'</span></span><br><span class="line">	queue.put(<span class="string">'xxx'</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"site now"</span>, queue.qsize()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readQ</span><span class="params">(queue)</span>:</span></span><br><span class="line">	val = queue.get(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'consumed object from Q... size now'</span>, \</span><br><span class="line">		queue.qsize()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writer</span><span class="params">(queue, loops)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(loops):</span><br><span class="line">		writeQ(queue)</span><br><span class="line">		sleep(randint(<span class="number">2</span>, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span><span class="params">(queue, loops)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(loops):</span><br><span class="line">		readQ(queue)</span><br><span class="line">		sleep(randint(<span class="number">2</span>, <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">funcs = (writer, reader)</span><br><span class="line">nfuncs = range(len(funcs))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	nloops = randint(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">	q = Queue(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">	threads = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nfuncs:</span><br><span class="line">		t = MyThreads(funcs[i], (q, nloops), funcs[i].__name__)</span><br><span class="line">		threads.append(t)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> nfuncs:</span><br><span class="line">		threads[i].start() </span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> ncuncs:</span><br><span class="line">		threads[i].join()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'all DONE'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __main__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure></p>
<p>这只是一个在多线程工作中，对资源使用分配的模式。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/python/">python</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/exp/">exp</a><a href="/tags/python/">python</a><a href="/tags/threading/">threading</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/01/17/python-多线程入门/" data-title="python 多线程入门 | Hear7v&#39;s Blog" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/02/21/python-项目开发基础/" title="python-项目开发基础">
  <strong>上一篇：</strong><br/>
  <span>
  python-项目开发基础</span>
</a>
</div>


<div class="next">
<a href="/2016/01/14/linux-suid-缓冲区溢出-权限提升实验/"  title="linux suid 缓冲区溢出 权限提升实验">
 <strong>下一篇：</strong><br/> 
 <span>linux suid 缓冲区溢出 权限提升实验
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本概念"><span class="toc-number">2.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#进程"><span class="toc-number">2.1.</span> <span class="toc-text">进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程"><span class="toc-number">2.2.</span> <span class="toc-text">线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局解释器"><span class="toc-number">2.3.</span> <span class="toc-text">全局解释器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#退出线程"><span class="toc-number">2.4.</span> <span class="toc-text">退出线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python_模块"><span class="toc-number">3.</span> <span class="toc-text">Python 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#thread模块"><span class="toc-number">3.1.</span> <span class="toc-text">thread模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#threading模块"><span class="toc-number">3.2.</span> <span class="toc-text">threading模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#守护线程"><span class="toc-number">3.2.1.</span> <span class="toc-text">守护线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Thread类"><span class="toc-number">3.2.2.</span> <span class="toc-text">Thread类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#threading模块中的其他函数"><span class="toc-number">3.2.3.</span> <span class="toc-text">threading模块中的其他函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#生产者消费者问题和Queue模块"><span class="toc-number">3.2.4.</span> <span class="toc-text">生产者消费者问题和Queue模块</span></a></li></ol></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/crypto/" title="crypto">crypto<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/misc/" title="misc">misc<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/pentest/" title="pentest">pentest<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/php/" title="php">php<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/web/" title="web">web<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/被动sql注入检测框架折腾/" title="被动sql注入检测框架折腾">被动sql注入检测框架折腾<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/python/" title="python">python<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/sqli/" title="sqli">sqli<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/exp/" title="exp">exp<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/代码审计/" title="代码审计">代码审计<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/phpcms/" title="phpcms">phpcms<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/漏洞挖掘/" title="漏洞挖掘">漏洞挖掘<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ssrf/" title="ssrf">ssrf<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/内网/" title="内网">内网<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/渗透/" title="渗透">渗透<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/object/" title="object">object<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/disable-functions/" title="disable_functions">disable_functions<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/php/" title="php">php<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/文件包含/" title="文件包含">文件包含<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/header/" title="header">header<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/insert/" title="insert">insert<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/project/" title="project">project<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/bypass/" title="bypass">bypass<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/moudle/" title="moudle">moudle<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.lynahex.com/" target="_blank" title="lynahex&#39;s Blog">lynahex&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> honesty and integrity surprisingly. <br/>
			null</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Hear7v">Hear7v</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
